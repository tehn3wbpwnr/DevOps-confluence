<!DOCTYPE html>
<html>
    <head>
        <title>DevOps / Pipeline &amp; Deployment : DynamicRegistration.js</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps / Pipeline &amp; Deployment</a></span>
                            </li>
                                                    <li>
                                <span><a href="1179353439.html">DevOps / Pipeline &amp; Deployment Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="DLX-Server-Documents_1541832718.html">DLX Server Documents</a></span>
                            </li>
                                                    <li>
                                <span><a href="All-about-LTI-Integration_1284603908.html">All about LTI Integration</a></span>
                            </li>
                                                    <li>
                                <span><a href="LTIjs-Library_1329463297.html">LTIjs Library</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps / Pipeline &amp; Deployment : DynamicRegistration.js
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                            
        
    
        
    
        
        
            Created by <span class='author'> Chris Park</span>, last modified by <span class='editor'> Jonathan Bezeau</span> on Sept 19, 2024
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>: This document discusses the 'Dynamic Registration' process when an LMS (e.g., Moodle, eConestoga) attempts to register an external tool (e.g., dlx-webhost, dlx-brightspace). It covers the HTTP requests, traffic, and significant code involved in the dynamic registration process using the LTIjs library, focusing on both Moodle and D2L registration.</p><hr/><style type='text/css'>/*<![CDATA[*/
div.rbtoc1748352958810 {padding: 0px;}
div.rbtoc1748352958810 ul {list-style: none;margin-left: 0px;}
div.rbtoc1748352958810 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style><div class='toc-macro rbtoc1748352958810'>
<ul class='toc-indentation'>
<li><a href='#DynamicRegistration.js-1.WorkFlowDiagram'>1. Work Flow Diagram</a></li>
<li><a href='#DynamicRegistration.js-2.EachStepExplanation'>2. Each Step Explanation</a>
<ul class='toc-indentation'>
<li><a href='#DynamicRegistration.js-2.1RegistrationRequest'>2.1 Registration Request</a></li>
<li><a href='#DynamicRegistration.js-2.2ChecktherequestbysessionValidator'>2.2 Check the request by sessionValidator</a></li>
<li><a href='#DynamicRegistration.js-2.3DynamicregistrationmiddlewarecheckswhetherDynamicRegistrationisactiveornot'>2.3 Dynamic registration middleware checks whether DynamicRegistration is active or not</a></li>
<li><a href='#DynamicRegistration.js-2.4_dynamicRegistrationCallback2checkswhetherparameterincludesopenid_configurationornot'>2.4 _dynamicRegistrationCallback2 checks whether parameter includes openid_configuration or not</a></li>
<li><a href='#DynamicRegistration.js-2.5Checkwether&#39;openid_configuration&#39;ismissingornot'>2.5 Check wether &#39;openid_configuration&#39; is missing or not</a></li>
<li><a href='#DynamicRegistration.js-2.6CreateHTTP:GETRequesttotheendpoint&amp;Storeconfigurationparametersintovariable'>2.6 Create HTTP:GET Request to the end point &amp;  Store configuration parameters into variable</a></li>
<li><a href='#DynamicRegistration.js-2.7CreateRegistrationform'>2.7 Create Registration form</a></li>
<li><a href='#DynamicRegistration.js-2.8CreateHTTP:POSTRequesttotheendpointStoreregistrationparametersintovariable'>2.8 Create HTTP:POST Request to the end point Store registration parameters into variable</a></li>
<li><a href='#DynamicRegistration.js-2.9CreateregisteredplatformdatasetandstoreitintotheLocalMongoDB'>2.9 Create registered platform dataset and store it into the Local MongoDB</a></li>
</ul>
</li>
</ul>
</div><hr/><h1 id="DynamicRegistration.js-1.WorkFlowDiagram">1. Work Flow Diagram</h1><p>: Each step is explained in the content below. For more details on a specific step, follow the links in the table above, which correspond to each step.</p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" alt="Dynamic Registration (2)-20240919-031934.png" width="760" loading="lazy" src="attachments/1340309568/1346076713.png?width=760" data-image-src="attachments/1340309568/1346076713.png" data-height="1260" data-width="2640" data-unresolved-comment-count="0" data-linked-resource-id="1346076713" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Dynamic Registration (2)-20240919-031934.png" data-base-url="https://varlab-dev.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1340309568" data-linked-resource-container-version="13" data-media-id="266298cf-4409-4fc8-ab82-4ea5e5ac7c75" data-media-type="file"></span><hr/><h1 id="DynamicRegistration.js-2.EachStepExplanation">2. Each Step Explanation</h1><p>: This content will explain each dynamic registration process as detailed as possible. Each process will be described based on the numbers shown in the diagram, and will include relevant code, JSON objects, and reference links for each process.<br/></p><h2 id="DynamicRegistration.js-2.1RegistrationRequest"><strong>2.1 Registration Request </strong></h2><p>: When LMS starts dynamic registration with tool registration URL(e.g. <a class="external-link" href="https://brightspacedlx.vconestoga.com" rel="nofollow">https://brightspacedlx.vconestoga.com</a>/register), it will send HTTP request with an <code>openid_configuration</code>and <code>registration_token</code>.</p><p /><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><code>openid_configuration </code>is a URL that <strong>contains the endpoint information of OIDC (OpenID Connect)</strong>. This URL is<strong> for accessing the configuration information</strong> provided by the OpenID Connect provider.</p></div></div><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><code>registration_token</code> is an <strong>authentication token in the form of JWT (JSON Web Token)</strong> that a specific tool or client uses to register itself with the platform. This token is<strong> issued by the platform</strong> and is used as an authentication when a tool registers with the platform.</p></div></div><p /><div id="expander-1932326056" class="expand-container"><div id="expander-control-1932326056" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Example Moodle: openid_configuration &amp; registration_token</span></div><div id="expander-content-1932326056" class="expand-content"><p><strong>[Original Form]</strong><br/>: <a class="external-link" href="https://brightspacedlx.vconestoga.com" rel="nofollow">https://brightspacedlx.vconestoga.com</a>/register?openid_configuration=https%3A%2F%<a class="external-link" href="http://2Fvconestoga.duckdns.org" rel="nofollow">2Fvconestoga.duckdns.org</a>%2Fmod%2Flti%2Fopenid-configuration.php&amp;registration_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IjM4MzUzNjJiODQwNTcyYTM2ODBhIn0.eyJzdWIiOiJZNTZIR3Y4MlR0NTREeUsiLCJzY29wZSI6InJlZyIsImlhdCI6MTcyNjE2ODI2MSwiZXhwIjoxNzI2MTcxODYxfQ.j5RCgNtloWee3LNAq6AXxLy1BxfVti8fmgn3lL6g8nQkRsVll8SKKGKWaGDERMW8CjHxbvdxwgqm_u5Iv3ugGW34QpZOKHexhXOXrcA1kAG17A7HMXxGpxHa3SNCiuMNrADSDXnus2w1nRZYFt68YOwqUUlnGsw_4F3DTtL34KdoTlloUfwJFIQRJ6JZur4ggPxUITtAwfarUvzUYz2jxkbk6uxgYeZ0jRiC3f6sdbZRD6QEIkP-9elppFAiG2PrBuO7cOWHzLl5eWeU_M8ijgfulFaeQqKJYwZXJgysTNcKv0iOBwZ01qq4UtvrKmUULtDMLY06miaeHjVN7_nVcw<br/><br/><strong>[Decrypt </strong><code>openid_configuration</code><strong>]</strong><br/>: <a class="external-link" href="https://brightspacedlx.vconestoga.com/register?openid_configuration=https://vconestoga.duckdns.org/mod/lti/openid-configuration.php&amp;registration_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IjM4MzUzNjJiODQwNTcyYTM2ODBhIn0.eyJzdWIiOiJZNTZIR3Y4MlR0NTREeUsiLCJzY29wZSI6InJlZyIsImlhdCI6MTcyNjE2ODI2MSwiZXhwIjoxNzI2MTcxODYxfQ.j5RCgNtloWee3LNAq6AXxLy1BxfVti8fmgn3lL6g8nQkRsVll8SKKGKWaGDERMW8CjHxbvdxwgqm_u5Iv3ugGW34QpZOKHexhXOXrcA1kAG17A7HMXxGpxHa3SNCiuMNrADSDXnus2w1nRZYFt68YOwqUUlnGsw_4F3DTtL34KdoTlloUfwJFIQRJ6JZur4ggPxUITtAwfarUvzUYz2jxkbk6uxgYeZ0jRiC3f6sdbZRD6QEIkP-9elppFAiG2PrBuO7cOWHzLl5eWeU_M8ijgfulFaeQqKJYwZXJgysTNcKv0iOBwZ01qq4UtvrKmUULtDMLY06miaeHjVN7_nVcw" rel="nofollow">openid_configuration=https://vconestoga.duckdns.org/mod/lti/openid-configuration.php</a></p><p>[<strong>Decrypt </strong><code>registration_token</code>]<br/>: registration_token={ &quot;typ&quot;: &quot;JWT&quot;, &quot;alg&quot;: &quot;RS256&quot;, &quot;kid&quot;: &quot;3835362b840572a3680a&quot; }, { &quot;sub&quot;: &quot;Y56HGV82Tt54DyK&quot;, &quot;scope&quot;: &quot;reg&quot;, &quot;iat&quot;: 1726168261, &quot;exp&quot;: 1726171861 }</p><p /></div></div><div id="expander-1033127477" class="expand-container"><div id="expander-control-1033127477" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Example D2L: openid_configuration &amp; registration_token</span></div><div id="expander-content-1033127477" class="expand-content"><p><strong>[Original Form]</strong><br/><strong>: </strong><a class="external-link" href="https://brightspacedlx.vconestoga.com" rel="nofollow">https://brightspacedlx.vconestoga.com</a>/register?openid_configuration=https%3a%2f%<a class="external-link" href="http://2ftestconestoga.desire2learn.com" rel="nofollow">2ftestconestoga.desire2learn.com</a>%2fd2l%2fle%2fltiadvantage%2f.well-known%2fopenid-configuration%3ftoolHost%<a class="external-link" href="http://3dwebdlx.vconestoga.com" rel="nofollow">3dwebdlx.vconestoga.com</a>%26token%3dJsnwiMsx--TklVqGZiyazHGmXOLNjHqVnASIetPF20M%257e</p><p><strong>[Decrypt </strong><code>openid_configuration</code><strong>]</strong><br/>:  <a class="external-link" href="https://testconestoga.desire2learn.com/d2l/le/ltiadvantage/.well-known/openid-configuration?toolHost=webdlx.vconestoga.com" rel="nofollow">https://testconestoga.desire2learn.com/d2l/le/ltiadvantage/.well-known/openid-configuration?toolHost=webdlx.vconestoga.com</a></p><p>[<strong>Decrypt </strong><code>registration_token</code>]<br/>: registration_token=JsnwiMsx--TklVqGZiyazHGmXOLNjHqVnASIetPF20M~</p></div></div><p /><h2 id="DynamicRegistration.js-2.2ChecktherequestbysessionValidator"><strong>2.2 Check the request by sessionValidator</strong></h2><p>: The <code>async</code> arrow function (<code>sessionValidator</code>)<span style="background-color: rgb(254,222,200);"> checks whether there are any matching predefined routes</span> and, if appropriate, passes control to the next middleware.<br/> In this case, the <code>async</code> function (<code>sessionValidator</code>) handles the <code>/register</code> request and passes the <code>openid_configuration</code> and <code>registration_token</code> to the dynamic registration middleware.</p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" alt="Untitled-20240918-141358.png" width="291" loading="lazy" src="attachments/1340309568/1344765956.png?width=291" data-image-src="attachments/1340309568/1344765956.png" data-height="10" data-width="291" data-unresolved-comment-count="0" data-linked-resource-id="1344765956" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Untitled-20240918-141358.png" data-base-url="https://varlab-dev.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1340309568" data-linked-resource-container-version="13" data-media-id="4b198fef-3211-4141-8dab-61a33127907e" data-media-type="file"></span><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" alt="image-20240917-205039.png" width="247" loading="lazy" src="attachments/1340309568/1342701588.png?width=247" data-image-src="attachments/1340309568/1342701588.png" data-height="70" data-width="247" data-unresolved-comment-count="0" data-linked-resource-id="1342701588" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20240917-205039.png" data-base-url="https://varlab-dev.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1340309568" data-linked-resource-container-version="13" data-media-id="125e6745-3a04-4d30-b804-39d3cd337acf" data-media-type="file"></span><div id="expander-1174971944" class="expand-container"><div id="expander-control-1174971944" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Codes: async Arrow Middleware Function (sessionValidator)</span></div><div id="expander-content-1174971944" class="expand-content"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">// Registers main athentication and routing middleware
   const sessionValidator = async (req, res, next) =&gt; {
     provMainDebug(&#39;Receiving request at path: &#39; + req.baseUrl + req.path);
     // Ckeck if request is attempting to initiate oidc login flow or access reserved routes
     if (req.path === (0, _classPrivateFieldGet2.default)(this, _loginRoute) || 
     req.path === (0, _classPrivateFieldGet2.default)(this, _keysetRoute) || 
     req.path === (0, _classPrivateFieldGet2.default)(this, _dynRegRoute)) 
     return next();</pre>
</div></div></div></div><p /><h2 id="DynamicRegistration.js-2.3DynamicregistrationmiddlewarecheckswhetherDynamicRegistrationisactiveornot"><strong>2.3 Dynamic registration middleware checks whether DynamicRegistration is active or not</strong></h2><p>:  The dynamic registration middleware is designed to handle HTTP requests. It checks whether <code>DynamicRegistration</code> is active, and if it is, passes the <code>openid_configuration</code> and <code>registration_token</code> parameters to the <code>_dynamicRegistrationCallback2</code> callback function for further processing.</p><p> If <code>this.DynamicRegistration</code> does not exist (i.e., if dynamic registration is disabled), the middleware returns a 403 Forbidden response to the client.<br/>  </p><div id="expander-179272107" class="expand-container"><div id="expander-control-179272107" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Codes: Dynamic Registration Middleware</span></div><div id="expander-content-179272107" class="expand-content"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">this.app.all((0, _classPrivateFieldGet2.default)(this, _dynRegRoute), async (req, res, next) =&gt; {
      if (this.DynamicRegistration) return (0, _classPrivateFieldGet2.default)(this, _dynamicRegistrationCallback2).call(this, req, res, next);
      return res.status(403).send({
        status: 403,
        error: &#39;Forbidden&#39;,
        details: {
          message: &#39;Dynamic registration is disabled.&#39;
        }
      });
    });</pre>
</div></div></div></div><p /><h2 id="DynamicRegistration.js-2.4_dynamicRegistrationCallback2checkswhetherparameterincludesopenid_configurationornot"><strong>2.4 _dynamicRegistrationCallback2 checks whether parameter includes openid_configuration or not</strong></h2><p>: The <code>_dynamicRegistrationCallback2</code> checks whether the request includes the <code>openid_configuration</code> parameter.</p><p>   &gt;&gt; If <code>openid_configuration</code>is present, it starts the <code>DynamicRegistration.register</code> process.</p><p>   &gt;&gt; If <code>openid_configuration</code> is missing, it returns a &quot;400: Bad Request&quot; response</p><p> During this process, different errors can be caught:</p><ul><li><p>&quot;403: Forbidden&quot; is returned if the platform is already registered,</p></li><li><p>&quot;500: Internal Server Error&quot; is returned for any other unhandled errors that occur during the registration process.<br/></p></li></ul><div id="expander-1948585467" class="expand-container"><div id="expander-control-1948585467" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Codes: _dynamicRegistrationCallback2 Callback Function</span></div><div id="expander-content-1948585467" class="expand-content"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">_classPrivateFieldInitSpec(this, _dynamicRegistrationCallback2, {
      writable: true,
      value: async (req, res, next) =&gt; {
        try {
          if (!req.query.openid_configuration) return res.status(400).send({
            status: 400,
            error: &#39;Bad Request&#39;,
            details: {
              message: &#39;Missing parameter: &quot;openid_configuration&quot;.&#39;
            }
          });
          const message = await this.DynamicRegistration.register(req.query.openid_configuration, req.query.registration_token);
          res.setHeader(&#39;Content-type&#39;, &#39;text/html&#39;);
          res.send(message);
        } catch (err) {
          provDynamicRegistrationDebug(err);
          if (err.message === &#39;PLATFORM_ALREADY_REGISTERED&#39;) return res.status(403).send({
            status: 403,
            error: &#39;Forbidden&#39;,
            details: {
              message: &#39;Platform already registered.&#39;
            }
          });
          return res.status(500).send({
            status: 500,
            error: &#39;Internal Server Error&#39;,
            details: {
              message: err.message
            }
          });
        }
      }
    });</pre>
</div></div></div></div><p /><h2 id="DynamicRegistration.js-2.5Checkwether&#39;openid_configuration&#39;ismissingornot"><strong>2.5 Check wether 'openid_configuration' is missing or not</strong></h2><p>: In the previous _dynamicRegistrationCallback2, <code>openid_configuration </code>was already checked once, but since DynamicRegistration.register can be called directly in another way, it is checked once more.</p><p>If <code>openid_configuration </code>is not found , throw an error '<code>MISSING_OPENID_CONFIGURATION</code>'.</p><p /><h2 id="DynamicRegistration.js-2.6CreateHTTP:GETRequesttotheendpoint&amp;Storeconfigurationparametersintovariable"><strong>2.6 Create HTTP:GET Request to the end point &amp;  Store configuration parameters into variable</strong></h2><p>: The actual dynamic registration process starts in this point. Tool provider(dlx-webhost, dlx-brightspace) request configuration information to an issuer(LMS) to get metadata that requires in dynamic registration process. </p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p> The configuration information can be different depending on LMS</p></div></div><p /><div id="expander-1079150660" class="expand-container"><div id="expander-control-1079150660" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Codes: Get Configuration Info Using openid_configuration </span></div><div id="expander-content-1079150660" class="expand-content"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">provDynamicRegistrationDebug(&#39;Starting dynamic registration process&#39;);

    // Get Platform registration configurations
    let configuration;
    try{
      provDynamicRegistrationDebug(&#39;OpenID Configurtaion: &#39; + openidConfiguration);
      configuration = await got.get(openidConfiguration).json();
      provDynamicRegistrationDebug(&#39;Recived Configuration Response:\n&#39; + JSON.stringify(configuration, null, 2));
    } catch (error)
    {
      provDynamicRegistrationDebug(error);
    }</pre>
</div></div></div></div><div id="expander-329376979" class="expand-container"><div id="expander-control-329376979" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Sample Response - Moodle: Configuration JSON Object </span></div><div id="expander-content-329376979" class="expand-content"><p><sub>{</sub><br/><sub>  &quot;issuer&quot;: &quot;</sub><a class="external-link" href="https://vconestoga.duckdns.org" rel="nofollow"><sub>https://vconestoga.duckdns.org</sub></a><sub>&quot;,</sub><br/><sub>  &quot;token_endpoint&quot;: &quot;</sub><a class="external-link" href="https://vconestoga.duckdns.org/mod/lti/token.php" rel="nofollow"><sub>https://vconestoga.duckdns.org/mod/lti/token.php</sub></a><sub>&quot;,</sub><br/><sub>  &quot;token_endpoint_auth_methods_supported&quot;: [</sub><br/><sub>    &quot;private_key_jwt&quot;</sub><br/><sub>  ],</sub><br/><sub>  &quot;token_endpoint_auth_signing_alg_values_supported&quot;: [</sub><br/><sub>    &quot;RS256&quot;</sub><br/><sub>  ],</sub><br/><sub>  &quot;jwks_uri&quot;: &quot;</sub><a class="external-link" href="https://vconestoga.duckdns.org/mod/lti/certs.php" rel="nofollow"><sub>https://vconestoga.duckdns.org/mod/lti/certs.php</sub></a><sub>&quot;,</sub><br/><sub>  &quot;authorization_endpoint&quot;: &quot;</sub><a class="external-link" href="https://vconestoga.duckdns.org/mod/lti/auth.php" rel="nofollow"><sub>https://vconestoga.duckdns.org/mod/lti/auth.php</sub></a><sub>&quot;,</sub><br/><sub>  &quot;registration_endpoint&quot;: &quot;</sub><a class="external-link" href="https://vconestoga.duckdns.org/mod/lti/openid-registration.php" rel="nofollow"><sub>https://vconestoga.duckdns.org/mod/lti/openid-registration.php</sub></a><sub>&quot;,</sub><br/><sub>  &quot;scopes_supported&quot;: [</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-bo/scope/basicoutcome" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-bo/scope/basicoutcome</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/lineitem.readonly" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/lineitem.readonly</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/result.readonly" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/result.readonly</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/score" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/score</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/lineitem" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/lineitem</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-nrps/scope/contextmembership.readonly" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-nrps/scope/contextmembership.readonly</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ts/scope/toolsetting" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ts/scope/toolsetting</sub></a><sub>&quot;,</sub><br/><sub>    &quot;openid&quot;</sub><br/><sub>  ],</sub><br/><sub>  &quot;response_types_supported&quot;: [</sub><br/><sub>    &quot;id_token&quot;</sub><br/><sub>  ],</sub><br/><sub>  &quot;subject_types_supported&quot;: [</sub><br/><sub>    &quot;public&quot;,</sub><br/><sub>    &quot;pairwise&quot;</sub><br/><sub>  ],</sub><br/><sub>  &quot;id_token_signing_alg_values_supported&quot;: [</sub><br/><sub>    &quot;RS256&quot;</sub><br/><sub>  ],</sub><br/><sub>  &quot;claims_supported&quot;: [</sub><br/><sub>    &quot;sub&quot;,</sub><br/><sub>    &quot;iss&quot;,</sub><br/><sub>    &quot;name&quot;,</sub><br/><sub>    &quot;given_name&quot;,</sub><br/><sub>    &quot;family_name&quot;,</sub><br/><sub>    &quot;email&quot;</sub><br/><sub>  ],</sub><br/><sub>  &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-platform-configuration" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-platform-configuration</sub></a><sub>&quot;: {</sub><br/><sub>    &quot;product_family_code&quot;: &quot;moodle&quot;,</sub><br/><sub>    &quot;version&quot;: &quot;3.10+ (Build: 20201217)&quot;,</sub><br/><sub>    &quot;messages_supported&quot;: [</sub><br/><sub>      &quot;LtiResourceLink&quot;,</sub><br/><sub>      &quot;LtiDeepLinkingRequest&quot;</sub><br/><sub>    ],</sub><br/><sub>    &quot;placements&quot;: [</sub><br/><sub>      &quot;AddContentMenu&quot;</sub><br/><sub>    ],</sub><br/><sub>    &quot;variables&quot;: [</sub><br/><sub>      &quot;basic-lti-launch-request&quot;,</sub><br/><sub>      &quot;ContentItemSelectionRequest&quot;,</sub><br/><sub>      &quot;ToolProxyRegistrationRequest&quot;,</sub><br/><sub>      &quot;</sub><a class="external-link" href="http://context.id/" rel="nofollow"><sub>http://context.id/</sub></a><sub>&quot;,</sub><br/><sub>      &quot;Context.title&quot;,</sub><br/><sub>      &quot;Context.label&quot;,</sub><br/><sub>      &quot;Context.id.history&quot;,</sub><br/><sub>      &quot;Context.sourcedId&quot;,</sub><br/><sub>      &quot;Context.longDescription&quot;,</sub><br/><sub>      &quot;Context.timeFrame.begin&quot;,</sub><br/><sub>      &quot;CourseSection.title&quot;,</sub><br/><sub>      &quot;CourseSection.label&quot;,</sub><br/><sub>      &quot;CourseSection.sourcedId&quot;,</sub><br/><sub>      &quot;CourseSection.longDescription&quot;,</sub><br/><sub>      &quot;CourseSection.timeFrame.begin&quot;,</sub><br/><sub>      &quot;</sub><a class="external-link" href="http://ResourceLink.id" rel="nofollow"><sub>ResourceLink.id</sub></a><sub>&quot;,</sub><br/><sub>      &quot;ResourceLink.title&quot;,</sub><br/><sub>      &quot;ResourceLink.description&quot;,</sub><br/><sub>      &quot;</sub><a class="external-link" href="http://User.id" rel="nofollow"><sub>User.id</sub></a><sub>&quot;,</sub><br/><sub>      &quot;User.username&quot;,</sub><br/><sub>      &quot;Person.name.full&quot;,</sub><br/><sub>      &quot;Person.name.given&quot;,</sub><br/><sub>      &quot;Person.name.family&quot;,</sub><br/><sub>      &quot;Person.email.primary&quot;,</sub><br/><sub>      &quot;Person.sourcedId&quot;,</sub><br/><sub>      &quot;Person.name.middle&quot;,</sub><br/><sub>      &quot;Person.address.street1&quot;,</sub><br/><sub>      &quot;Person.address.locality&quot;,</sub><br/><sub>      &quot;Person.address.country&quot;,</sub><br/><sub>      &quot;Person.address.timezone&quot;,</sub><br/><sub>      &quot;Person.phone.primary&quot;,</sub><br/><sub>      &quot;Person.phone.mobile&quot;,</sub><br/><sub>      &quot;Person.webaddress&quot;,</sub><br/><sub>      &quot;Membership.role&quot;,</sub><br/><sub>      &quot;Result.sourcedId&quot;,</sub><br/><sub>      &quot;Result.autocreate&quot;,</sub><br/><sub>      &quot;BasicOutcome.sourcedId&quot;,</sub><br/><sub>      &quot;BasicOutcome.url&quot;,</sub><br/><sub>      &quot;Moodle.Person.userGroupIds&quot;</sub><br/><sub>    ]</sub><br/><sub>  }</sub><br/><sub>}</sub></p></div></div><p /><h2 id="DynamicRegistration.js-2.7CreateRegistrationform"><strong>2.7 Create Registration form</strong></h2><p>: In this step, the tool provider prepares a registration JSON object for tool registration based on the<u> IMS Global Standard</u>, ensuring that it includes necessary fields such as client information, redirect URIs, and supported authentication methods. This object will be sent to the platform's registration endpoint to initiate the dynamic registration process.</p><p /><div id="expander-622555735" class="expand-container"><div id="expander-control-622555735" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Codes: Create Registration JSON Object</span></div><div id="expander-content-622555735" class="expand-content"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">provDynamicRegistrationDebug(&#39;Attempting to register Platform with issuer: &#39;, configuration.issuer);
    // Building registration object
    const registration = {
      application_type: &#39;web&#39;,
      response_types: [&#39;id_token&#39;],
      grant_types: [&#39;implicit&#39;, &#39;client_credentials&#39;],
      initiate_login_uri: (0, _classPrivateFieldGet2.default)(this, _loginUrl),
      redirect_uris: [...(0, _classPrivateFieldGet2.default)(this, _redirectUris), (0, _classPrivateFieldGet2.default)(this, _appUrl)],
      client_name: (0, _classPrivateFieldGet2.default)(this, _name),
      jwks_uri: (0, _classPrivateFieldGet2.default)(this, _keysetUrl),
      logo_uri: (0, _classPrivateFieldGet2.default)(this, _logo),
      token_endpoint_auth_method: &#39;private_key_jwt&#39;,
      scope: &#39;https://purl.imsglobal.org/spec/lti-ags/scope/lineitem.readonly https://purl.imsglobal.org/spec/lti-ags/scope/lineitem https://purl.imsglobal.org/spec/lti-ags/scope/score https://purl.imsglobal.org/spec/lti-ags/scope/result.readonly https://purl.imsglobal.org/spec/lti-nrps/scope/contextmembership.readonly&#39;,
      &#39;https://purl.imsglobal.org/spec/lti-tool-configuration&#39;: {
        domain: (0, _classPrivateFieldGet2.default)(this, _hostname),
        description: (0, _classPrivateFieldGet2.default)(this, _description),
        target_link_uri: (0, _classPrivateFieldGet2.default)(this, _appUrl),
        custom_parameters: (0, _classPrivateFieldGet2.default)(this, _customParameters),
        claims: configuration.claims_supported,
        messages: [{
          type: &#39;LtiDeepLinkingRequest&#39;
        }, {
          type: &#39;LtiResourceLink&#39;
        }]
      }
    };</pre>
</div></div></div></div><ul><li><p><u>IMS GLOBAL-tool-configuration Link</u><br/>: <a class="external-link" data-card-appearance="inline" href="https://www.imsglobal.org/spec/lti-dr/v1p0#tool-configuration" rel="nofollow">https://www.imsglobal.org/spec/lti-dr/v1p0#tool-configuration</a> </p></li></ul><p /><h2 id="DynamicRegistration.js-2.8CreateHTTP:POSTRequesttotheendpointStoreregistrationparametersintovariable"><strong>2.8 Create HTTP:POST Request to the end point Store registration parameters into variable</strong></h2><p>: In this step, the tool provider creates an HTTP POST request to the <code>configuration.registration_endpoint</code> obtained from the <code>configuration</code> object, along with the <code>registrationToken</code> and the <code>registration</code> object.</p><p> This process aims to obtain the LMS registration information, which will then be stored in the tool provider's database. The response from the LMS contains the <code>client_id</code>, <code>deployment_id</code> and other crucial data needed for further communication between the tool and the LMS.</p><p /><div id="expander-767984934" class="expand-container"><div id="expander-control-767984934" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Sample Response - Moodle: Registration JSON Object</span></div><div id="expander-content-767984934" class="expand-content"><p><sub>{</sub><br/><sub>  &quot;application_type&quot;: &quot;web&quot;,</sub><br/><sub>  &quot;response_types&quot;: [&quot;id_token&quot;],</sub><br/><sub>  &quot;grant_types&quot;: [&quot;implicit&quot;, &quot;client_credentials&quot;],</sub><br/><sub>  &quot;initiate_login_uri&quot;: &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/login" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/login</sub></a><sub>&quot;,</sub><br/><sub>  &quot;redirect_uris&quot;: [</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/rab" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/rab</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/mpcl1" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/mpcl1</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/mpcl2" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/mpcl2</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/launchtesting" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/launchtesting</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/reactmultiplayerapp" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/reactmultiplayerapp</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/Powerline" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/Powerline</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/CORE-Sandbox-V2" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/CORE-Sandbox-V2</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/Public-Health-Inspection" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/Public-Health-Inspection</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/Trades-Electrical" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/Trades-Electrical</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/Paramedic-Ambulance" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/Paramedic-Ambulance</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/LTI-Package-Test" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/LTI-Package-Test</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/EcoQuorum" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/EcoQuorum</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/Photogrammetry" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/Photogrammetry</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app</sub></a><sub>&quot;</sub><br/><sub>  ],</sub><br/><sub>  &quot;client_name&quot;: &quot;Chris Remote DLX&quot;,</sub><br/><sub>  &quot;jwks_uri&quot;: &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/keys" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/keys</sub></a><sub>&quot;,</sub><br/><sub>  &quot;logo_uri&quot;: undefined,</sub><br/><sub>  &quot;token_endpoint_auth_method&quot;: &quot;private_key_jwt&quot;,</sub><br/><sub>  &quot;scope&quot;: &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/lineitem.readonly" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/lineitem.readonly</sub></a><sub> </sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/lineitem" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/lineitem</sub></a><sub> </sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/score" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/score</sub></a><sub> </sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/result.readonly" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/result.readonly</sub></a><sub> </sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-nrps/scope/contextmembership.readonly" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-nrps/scope/contextmembership.readonly</sub></a><sub>&quot;,</sub><br/><sub>  &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-tool-configuration" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-tool-configuration</sub></a><sub>&quot;: {</sub><br/><sub>    &quot;domain&quot;: &quot;6960-72-138-14-22.ngrok-free.app&quot;,</sub><br/><sub>    &quot;description&quot;: undefined,</sub><br/><sub>    &quot;target_link_uri&quot;: &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app</sub></a><sub>&quot;,</sub><br/><sub>    &quot;custom_parameters&quot;: {},</sub><br/><sub>    &quot;claims&quot;: [&quot;sub&quot;, &quot;iss&quot;, &quot;name&quot;, &quot;given_name&quot;, &quot;family_name&quot;, &quot;email&quot;],</sub><br/><sub>    &quot;messages&quot;: [[Object], [Object]]</sub><br/><sub>  }</sub><br/><sub>}</sub></p><p><sub>Sending Tool registration request:</sub></p><p><sub>{</sub><br/><sub>  &quot;client_id&quot;: &quot;JLnfeKUJSGbplZg&quot;,</sub><br/><sub>  &quot;token_endpoint_auth_method&quot;: &quot;private_key_jwt&quot;,</sub><br/><sub>  &quot;response_types&quot;: [&quot;id_token&quot;],</sub><br/><sub>  &quot;jwks_uri&quot;: &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/keys" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/keys</sub></a><sub>&quot;,</sub><br/><sub>  &quot;initiate_login_uri&quot;: &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/login" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/login</sub></a><sub>&quot;,</sub><br/><sub>  &quot;grant_types&quot;: [&quot;client_credentials&quot;, &quot;implicit&quot;],</sub><br/><sub>  &quot;redirect_uris&quot;: [</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/rab" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/rab</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/mpcl1" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/mpcl1</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/mpcl2" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/mpcl2</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/launchtesting" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/launchtesting</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/reactmultiplayerapp" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/reactmultiplayerapp</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/Powerline" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/Powerline</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/CORE-Sandbox-V2" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/CORE-Sandbox-V2</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/Public-Health-Inspection" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/Public-Health-Inspection</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/Trades-Electrical" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/Trades-Electrical</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/Paramedic-Ambulance" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/Paramedic-Ambulance</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/LTI-Package-Test" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/LTI-Package-Test</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/EcoQuorum" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/EcoQuorum</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app/dlx/Photogrammetry" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app/dlx/Photogrammetry</sub></a><sub>&quot;,</sub><br/><sub>    &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app</sub></a><sub>&quot;</sub><br/><sub>  ],</sub><br/><sub>  &quot;application_type&quot;: [&quot;web&quot;],</sub><br/><sub>  &quot;client_name&quot;: &quot;Chris Remote DLX&quot;,</sub><br/><sub>  &quot;logo_uri&quot;: &quot;&quot;,</sub><br/><sub>  &quot;scope&quot;: &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/score" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/score</sub></a><sub> </sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/result.readonly" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/result.readonly</sub></a><sub> </sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/lineitem.readonly" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/lineitem.readonly</sub></a><sub> </sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-ags/scope/lineitem" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-ags/scope/lineitem</sub></a><sub> </sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-nrps/scope/contextmembership.readonly" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-nrps/scope/contextmembership.readonly</sub></a><sub>&quot;,</sub><br/><sub>  &quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-tool-configuration" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-tool-configuration</sub></a><sub>&quot;: {</sub><br/><sub>    &quot;deployment_id&quot;: &quot;310&quot;,</sub><br/><sub>    &quot;target_link_uri&quot;: &quot;</sub><a class="external-link" href="https://6960-72-138-14-22.ngrok-free.app" rel="nofollow"><sub>https://6960-72-138-14-22.ngrok-free.app</sub></a><sub>&quot;,</sub><br/><sub>    &quot;domain&quot;: &quot;6960-72-138-14-22.ngrok-free.app&quot;,</sub><br/><sub>    &quot;description&quot;: &quot;&quot;,</sub><br/><sub>    &quot;messages&quot;: [</sub><br/><sub>      {</sub><br/><sub>        &quot;type&quot;: &quot;LtiDeepLinkingRequest&quot;,</sub><br/><sub>        &quot;target_link_uri&quot;: &quot;&quot;</sub><br/><sub>      }</sub><br/><sub>    ],</sub><br/><sub>    &quot;claims&quot;: [&quot;sub&quot;, &quot;iss&quot;, &quot;name&quot;, &quot;family_name&quot;, &quot;middle_name&quot;, &quot;email&quot;]</sub><br/><sub>  }</sub><br/><sub>}</sub></p></div></div><p /><h2 id="DynamicRegistration.js-2.9CreateregisteredplatformdatasetandstoreitintotheLocalMongoDB"><strong>2.9</strong> <strong>Create registered platform dataset and store it into the Local MongoDB</strong></h2><p>: After receiving registration information from LMS, the tool provider starts the process of storing the received metadata into the server's MongoDB.</p><p> The process tries to create a ‘platformName' using the configuration object obtained in step 6. It checks whether the configuration contains the key ['<a class="external-link" href="https://purl.imsglobal.org/spec/lti-platform-configuration" rel="nofollow">https://purl.imsglobal.org/spec/lti-platform-configuration</a>'].</p><p> &gt;&gt; If it does, the value of ['<a class="external-link" href="https://purl.imsglobal.org/spec/lti-platform-configuration" rel="nofollow">https://purl.imsglobal.org/spec/lti-platform-configuration</a>'].product_family_code is used.</p><p> &gt;&gt; If not, a default platform name 'Platform' is used.</p><p>A 16-byte random string is appended to the platform name at the end.</p><div id="expander-124543056" class="expand-container"><div id="expander-control-124543056" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Sample key-value pair of [&#39;https://purl.imsglobal.org/spec/lti-platform-configuration&#39;].product_family_code</span></div><div id="expander-content-124543056" class="expand-content"><p><sub>&quot;</sub><a class="external-link" href="https://purl.imsglobal.org/spec/lti-platform-configuration" rel="nofollow"><sub>https://purl.imsglobal.org/spec/lti-platform-configuration</sub></a><sub>&quot;: {</sub><br/><sub>    &quot;product_family_code&quot;: &quot;moodle&quot;,</sub><br/><sub>    &quot;version&quot;: &quot;3.10+ (Build: 20201217)&quot;,</sub><br/><sub>    &quot;messages_supported&quot;: [</sub><br/><sub>      &quot;LtiResourceLink&quot;,</sub><br/><sub>      &quot;LtiDeepLinkingRequest&quot;</sub><br/><sub>    ]</sub></p></div></div><p>  After creating '<code>platformName</code>', it stores platform’s {<code>url</code>, <code>name</code>, <code>clientId</code>, <code>authenticationEndpoint</code>, <code>accesstokenEndpoint</code>, <code>authorizationServer</code>, <code>authConfig</code>} information into local MongoDB. </p><p /><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>This stored data can be found in { MongoDB: &gt;&gt; ‘test’ db &gt;&gt; ‘platforms’ collection }</p></div></div><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>  If the platform information already exists in database, it throws an error <code>'PLATFORM_ALREADY_REGISTERED'</code></p></div></div><p /><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" alt="image-20240919-135106.png" width="760" loading="lazy" src="attachments/1340309568/1347223555.png?width=760" data-image-src="attachments/1340309568/1347223555.png" data-height="368" data-width="767" data-unresolved-comment-count="0" data-linked-resource-id="1347223555" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20240919-135106.png" data-base-url="https://varlab-dev.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1340309568" data-linked-resource-container-version="13" data-media-id="dcf644c2-a074-49d4-b25b-ccf5ce83aa69" data-media-type="file"></span><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image image-center" alt="image-20240919-144015.png" width="421" loading="lazy" src="attachments/1340309568/1347354627.png?width=421" data-image-src="attachments/1340309568/1347354627.png" data-height="145" data-width="421" data-unresolved-comment-count="0" data-linked-resource-id="1347354627" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image-20240919-144015.png" data-base-url="https://varlab-dev.atlassian.net/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="1340309568" data-linked-resource-container-version="13" data-media-id="9204d4b2-6be5-41ec-ae8f-71eaa43d3735" data-media-type="file"></span><div id="expander-1894772647" class="expand-container"><div id="expander-control-1894772647" class="expand-control"><span class="expand-control-icon"><img style="vertical-align:middle;" class="expand-control-image" src="images/icons/grey_arrow_down.png"></span><span class="expand-control-text">Codes: Insert Platform Meta Data to Database </span></div><div id="expander-content-1894772647" class="expand-content"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: js; gutter: false; theme: Confluence" data-theme="Confluence">// Registering Platform
    const platformName = (configuration[&#39;https://purl.imsglobal.org/spec/lti-platform-configuration&#39;] ? configuration[&#39;https://purl.imsglobal.org/spec/lti-platform-configuration&#39;].product_family_code : &#39;Platform&#39;) + &#39;_DynReg_&#39; + crypto.randomBytes(16).toString(&#39;hex&#39;);
    if (await (0, _classPrivateFieldGet2.default)(this, _getPlatform).call(this, configuration.issuer, registrationResponse.client_id, (0, _classPrivateFieldGet2.default)(this, _ENCRYPTIONKEY), (0, _classPrivateFieldGet2.default)(this, _Database))) throw new Error(&#39;PLATFORM_ALREADY_REGISTERED&#39;);
    provDynamicRegistrationDebug(&#39;Registering Platform&#39;);
    const platform = {
      url: configuration.issuer,
      name: platformName,
      clientId: registrationResponse.client_id,
      authenticationEndpoint: configuration.authorization_endpoint,
      accesstokenEndpoint: configuration.token_endpoint,
      authorizationServer: configuration.authorization_server || configuration.token_endpoint,
      authConfig: {
        method: &#39;JWK_SET&#39;,
        key: configuration.jwks_uri
      }
    };
    const registered = await (0, _classPrivateFieldGet2.default)(this, _registerPlatform).call(this, platform, (0, _classPrivateFieldGet2.default)(this, _getPlatform), (0, _classPrivateFieldGet2.default)(this, _ENCRYPTIONKEY), (0, _classPrivateFieldGet2.default)(this, _Database));
    await (0, _classPrivateFieldGet2.default)(this, _Database).Insert(false, &#39;platformStatus&#39;, {
      id: await registered.platformId(),
      active: (0, _classPrivateFieldGet2.default)(this, _autoActivate)
    });</pre>
</div></div></div></div>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1342439428.png">Blank diagram-20240917-171828.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1341292551.png">Blank diagram (1)-20240917-174404.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1341489158.png">Blank diagram (2)-20240917-174610.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1341620234.png">Blank diagram (3)-20240917-175314.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1341882372.png">Blank diagram (3)-20240917-175314.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1342701588.png">image-20240917-205039.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1344110597.png">Dynamic Registration-20240918-023958.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1344765956.png">Untitled-20240918-141358.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1346109441.png">Dynamic Registration (1)-20240918-234208.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1346076713.png">Dynamic Registration (2)-20240919-031934.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1347289091.png">image-20240919-134116.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1347223555.png">image-20240919-135106.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1346994178.png">image-20240919-141853.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/1340309568/1347354627.png">image-20240919-144015.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 27, 2025 13:35</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
